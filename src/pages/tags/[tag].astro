---
import { getCollection } from "astro:content";
import Base from "../../layouts/Base.astro";
import ArticleList from "../../components/ArticleList.astro";

export async function getStaticPaths() {
  const articles = await getCollection("articles", ({ data }) => !data.draft && data.lang === "en");
  const tags = new Set<string>();
  for (const article of articles) {
    for (const tag of article.data.tags) {
      tags.add(tag);
    }
  }
  return [...tags].map((tag) => ({
    params: { tag },
    props: {
      tag,
      articles: articles
        .filter((a) => a.data.tags.includes(tag))
        .sort((a, b) => b.data.date.getTime() - a.data.date.getTime()),
    },
  }));
}

const { tag, articles } = Astro.props;
---

<Base title={`Tag: ${tag}`} lang="en">
  <div class="container-inner">
    <h1 class="text-3xl font-bold mb-8">Tag: {tag}</h1>
    <ArticleList articles={articles} />
  </div>
</Base>
