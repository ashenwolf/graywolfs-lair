---
import { getCollection } from "astro:content";
import Base from "../layouts/Base.astro";
import SocialLinks from "../components/SocialLinks.astro";
import ArticleCardFeatured from "../components/ArticleCardFeatured.astro";
import SectionBlock from "../components/SectionBlock.astro";
import { getArticlesWithUrls } from "../utils/articleUrls";

const allArticles = (
  await getCollection("articles", ({ data }) => !data.draft && data.lang === "en")
).sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const latestArticles = getArticlesWithUrls(allArticles.slice(0, 6));

const byCategory = (cat: string) =>
  getArticlesWithUrls(allArticles.filter((a) => a.data.category === cat).slice(0, 4));
---

<Base title="Home" lang="en">

  <!-- Hero -->
  <section class="bg-hero-bg w-full">
    <div class="max-w-5xl mx-auto px-8 py-8 flex flex-col md:flex-row items-stretch gap-12">
      <div class="flex-1 min-w-0 flex flex-col justify-center">
        <h1 class="text-4xl md:text-5xl font-extrabold mb-5 leading-tight tracking-tight">
          Hello, I'm Sergii Gulenok
        </h1>
        <p class="text-gray-700 text-lg leading-relaxed mb-3">
          Software engineer, traveller.
        </p>
        <p class="text-gray-600 text-base leading-relaxed mb-8">
          I write about code, journeys, and whatever comes to mind.
        </p>
        <SocialLinks />
      </div>
      <div class="flex-1 min-w-0 flex items-center justify-center">
        <!-- Replace with <img> when photo is ready -->
        <div class="w-[420px] aspect-[2/3] rounded-2xl bg-gray-300 flex items-center justify-center text-gray-500 text-sm text-center px-4 photo-glow">
          Photo with dog<br />coming soon
        </div>
      </div>
    </div>
  </section>

  <!-- Latest Articles -->
  <section class="max-w-5xl mx-auto px-8 py-16">
    <h2 class="text-2xl font-bold mb-8">Latest Articles</h2>
    {latestArticles.length > 0 ? (
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
        {latestArticles.map((article) => (
          <ArticleCardFeatured
            href={article.url}
            title={article.data.title}
            date={article.data.date}
            category={article.data.category}
            image={article.data.image}
            lang="en"
          />
        ))}
      </div>
    ) : (
      <p class="text-gray-400">No articles yet.</p>
    )}
  </section>

  <!-- Category sections -->
  <div class="max-w-5xl mx-auto px-8 pb-16">
    <SectionBlock
      title="Software Engineering"
      description="Deep dives into code, architecture, and the craft of building software."
      moreHref="/tags/software-engineering"
      articles={byCategory("software-engineering")}
      lang="en"
    />
    <SectionBlock
      title="Travel"
      description="Stories and photos from places around the world."
      moreHref="/tags/travel"
      articles={byCategory("travel")}
      lang="en"
    />
    <SectionBlock
      title="Life"
      description="Reflections, opinions, and things I find worth writing about."
      moreHref="/tags/life"
      articles={byCategory("life")}
      lang="en"
    />
  </div>

</Base>
