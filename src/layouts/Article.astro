---
import Base from "./Base.astro";
import { CATEGORY_LABELS } from "../constants/labels";
import type { Lang } from "../constants/labels";
import { formatDate } from "../utils/date";

interface Props {
  title: string;
  date: Date;
  tags: string[];
  lang?: "en" | "ua";
  category?: string;
  image?: string;
  description?: string | null;
}

const { title, date, tags, lang = "en", category, image, description } = Astro.props;

const tagBase = lang === "ua" ? "/ua/tags" : "/tags";
---

<Base title={title} lang={lang} description={description ?? undefined} image={image ?? undefined}>
  {image && (
    <div class="w-full max-h-96 overflow-hidden">
      <img src={image} alt={title} class="w-full h-full object-cover" loading="eager" />
    </div>
  )}
  <article class="max-w-3xl mx-auto px-4 sm:px-8 py-12">
    <header class="mb-8">
      {category && (
        <span class="text-xs font-semibold uppercase tracking-wider text-accent block mb-2">
          {(CATEGORY_LABELS[category as keyof typeof CATEGORY_LABELS]?.[lang as Lang]) ?? category}
        </span>
      )}
      <h1 class="text-3xl font-bold mb-2">{title}</h1>
      <time class="text-sm text-gray-500" datetime={date.toISOString()}>
        {formatDate(date, lang as Lang, "long")}
      </time>
      {tags.length > 0 && (
        <div class="mt-3 flex flex-wrap gap-2">
          {tags.map((tag) => (
            <a
              href={`${tagBase}/${tag}`}
              class="text-sm bg-gray-100 px-2 py-0.5 rounded hover:bg-gray-200 transition-colors"
            >
              {tag}
            </a>
          ))}
        </div>
      )}
    </header>
    <div class="prose prose-gray max-w-none">
      <slot />
    </div>
    <div id="disqus_thread" class="mt-12"></div>
    <script>
      var disqus_config = function () {
        this.page.url = window.location.href;
        this.page.identifier = window.location.pathname;
      };
      (function () {
        var d = document, s = d.createElement("script");
        s.src = "https://graywolfs-lair.disqus.com/embed.js";
        s.setAttribute("data-timestamp", +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
  </article>
</Base>
